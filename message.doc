CIF报文结构格式讨论

1.	报文整体结构
报文整体结构如下：
报文头（8位数字）	报文体（作业条数据）
报文结构格式由报文头和报文体两部分组成。
报文头：8位数字，表示报文体的长度
报文体：作业条数据

2.	报文体定义
报文体就是完整的作业条数据，作业条格式采用现成的与AS400交换的报文格式。作业条数剧由作业头、作业接口、作业正文3部分构成，每个作业条可以有N个作业接口，每个作业接口可以有M个作业正文
 


2.1.	数据类型说明
类型	说明	约束
A	ASCII类型字符串	只包含ASCII字符
S	数字类型字符串	只包含0-9，S(x,y)标识x位长度，其中从右往左第y位为小数点位，如S(3,2)类型的数字123表示1.23, S(8,0)类型的20090211表示数字20090211
O	多字节字符类型字符串	可包含ASCII字符或中文字符
D	日期类型	日期格式为yyyyMMdd
T	时间类型	时间格式为HHmmss

2.2.	数据处理原则
1.	A，O型数据：如果字段值长度小于定义长度，则在字段值右侧补空格。例如：定义长度为8，实际字段值为“abc”，则完整字段值如下。
1	2	3	4	5	6	7	8
a	b	c	空格	空格	空格	空格	空格

2.	D，T型数据：如果字段值长度小于定义长度，则在字段值左侧补“0”。例如：定义长度为8，实际字段值为“120825”，则完整字段值如下。
1	2	3	4	5	6	7	8
0	0	1	2	0	8	2	5

3.	S型数据：首先通过右侧补“0”来补足小数位长度，然后再通过左侧补“0”来补足字段值整体长度。例如S(8,4)，实际字段值为12.34，则完整字段值如下。
1	2	3	4	5	6	7	8
0	0	1	2	3	4	0	0

4.	A，O型数据空值判断：如果字段值全部由空格组成，则认为该字段为空。例如字段定义长度为8，则空字段表示如下。
1	2	3	4	5	6	7	8
空格	空格	空格	空格	空格	空格	空格	空格

5.	S，D，T型数据：如果字段值全部由“0”组成，则认为该字段为空。例如字段定义长度为8，则空字段表示如下。
1	2	3	4	5	6	7	8
0	0	0	0	0	0	0	0

6.	负数处理原则是按照数字补零原则补足长度后，把右起第一位数字替换为特殊字符。
数字特殊字符替换映射表如下：
0	1	2	3	4	5	6	7	8	9
}	J	K	L	M	N	O	P	Q	R

例1：S(8,0)类型-12345678表示如下
1	2	3	4	5	6	7	8
1	2	3	4	5	6	7	Q

例2：S(8,0)类型-1234表示如下
1	2	3	4	5	6	7	8
0	0	0	0	1	2	3	M

例3：S(8,4)类型-1234.5678表示如下
1	2	3	4	5	6	7	8
1	2	3	4	5	6	7	Q

例1：S(8,4)类型-12.34表示如下
1	2	3	4	5	6	7	8
0	0	1	2	3	4	0	}



2.3.	作业头
长度为：203，最后两位规定了作业接口个数
域名称	长度	小数位数	数据类型	说明
TYPCOD	2	0	A 	报文类型
HDRLEN	4	0	S 	报文头部长度（固定0203）
SYSCOD	2	0	A 	主机业务系统代码
DSKSYS	2	0	A 	前台业务系统代码
PRCCOD	8	0	A 	工作条码（原处理码）
KEYVAL	32	0	A	业务键值
ISUCNL	3	0	A 	发起方通道编码
ENCCOD	1	0	A 	加密标记
DALCOD	1	0	A 	数据续传标记
CMMTYP	1	0	A 	通讯类型
ORGISU	10	0	A	交易原始发起方
PREISU	10	0	A	交易上一发起方
ENTUSR	10	0	A	登录用户
USRPWD	16	0	A	用户密码
ISUDAT	8	0	D 	发起方系统日期
ISUTIM	6	0	T 	发起方系统时间
MACCOD	8	0	A 	MAC Code
RTNLVL	2	0	A 	返回信息级别，20短信息，40 长信息
RTNCOD	7	0	A 	返回信息码
DEVNBR	10	0	A	注册设备号
TLRNBR	6	0	A 	柜员号
RQSNBR	12	0	A	通讯请求号
CMMRSV	12	0	A	通讯中间界系统保留字段
DOCSIZ	8	0	A 	文档大小
ITVTMS	2	0	A 	交互次数
MSGFLG	1	0	A 	消息标志
APPRSV	19	0	A	业务系统保留字段
FMTCNT	2	0	S 	接口个数

2.4.	作业接口
长度为：20，接口名称与作业正文的名称相对应
域名称	长度	小数位数	数据类型	说明
FMTCOD	10	0	A 	接口名称
RECCNT	4	0	S 	记录个数
RECLEN	6	0	S	记录长度

2.5.	作业正文
作业正文的名称、长度、个数在作业接口中应该预先定义好
如：登录退出申请报文KPIBP805X
域名称	长度	小数位数	数据类型	说明
xMsgIdn	35	0	A	报文标识号 
xSndTim	19	0	A	发送时间,YYYY-MM-DDTHH:MM:SS
xSndPar	12	0	A	发起参与机构
xRcvPar	12	0	A	接收参与机构,IBPS-NPC 号码
xSysCod	4	0	A	系统号,IPBS
xOprTyp	4	0	A	操作类型,OT00登录,OT01退出

3.	报文示例分析
3.1.	报文数据案例
00000481120205LGMBKPIBU805                                                          *CLIET                    20100305182030          SUC0000                                                                      02KPIBPHDRX 0001000150KPIBP805X 000100008630858400068910258400025320100305150330ccms.805.001.01     MSGID308201003050001REFID308201003050001UY         N                                        30858400068920100305CMBWKEID00000012010-03-12T17:30:30308584000689001100000001IBPSOT00

3.2.	报文数据案里分析
报文长度
00000481

作业头
120205LGMBKPIBU805                                                          *CLIET                    20100305182030          SUC0000                                                                      02

作业接口
KPIBPHDRX 0001000150KPIBP805X 0001000086

作业正文
30858400068910258400025320100305150330ccms.805.001.01     MSGID308201003050001REFID308201003050001UY         N                                        30858400068920100305CMBWKEID00000012010-03-12T17:30:30308584000689001100000001IBPSOT00

